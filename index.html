<!DOCTYPE HTML>
<html>
<head>
	<title>Sterbin</title>
	<script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha256-/SIrNqv8h6QGKDuNoLGA4iret+kyesCkHGzVUUV0shc=" crossorigin="anonymous"></script>
</head>
<body>
	<input type="text" id="sterbin" value="Steven" style="min-width: 400px;"/>
	<button type="button" id="doIt">Sterbinify</button> <br/> <br/>
	<div id="history">
	</div>
	
	<script>
		function Replacement(replace, replacer) {
			this.original = replace;
			this.new = replacer;
		}
	
		var replacementDict = [
			new Replacement("v", "ph"),
			new Replacement("ph", "phph"),
			new Replacement("ph", "fe"),
			new Replacement("bin", "erbin"),
			new Replacement("st", "pht"),
			new Replacement("e", "eve"),
			new Replacement("b", "beeb"),
			new Replacement("b", "bl"),
			new Replacement("v", "fph"),
			new Replacement("eb", "erb"),
			new Replacement("ven", "bin"),
			new Replacement("ph", "phb"),
			new Replacement("ph", "bph"),
			new Replacement("sterbin", "sterbinflerben"),
			new Replacement("er", "fler"),
			new Replacement("bin", "flerben"),
			
			//Reducers
			new Replacement("eee", "ee"),
			new Replacement("bbb", "bb"),
			new Replacement("phphph", "phph"),
			new Replacement("eee", "ee"),
			new Replacement("bbb", "bb"),
			new Replacement("phphph", "phph")
		]
		
		function indexes(source, find) {
			var result = [];
			for (i = 0; i < source.length; ++i) {
				if (source.substring(i, i + find.length) == find) {
					result.push(i);
				}
			}
			return result;
		}
	
		$("#doIt").on("click", function() {
			var text = $("#sterbin").val();
			var history = $("#history");
			
			var index = -1;
			var count = 0;
			
			while(index < 0) {
				if (count >= 1000) {
					alert("couldn't find replacement in 1000 tries");
					throw {
						name: "I couldn't do it exception",
						message: "sterbin come back, ooooooooh you can blame it all on me",
						toString: function() {return this.name + ": " + this.message;}
					};
				}
			
				var rand = Math.floor(Math.random() * replacementDict.length);
				index = text.indexOf(replacementDict[rand].original);
				
				count++;
			}
			
			var indexArr = indexes(text, replacementDict[rand].original);
			var randIndex = Math.floor(Math.random() * indexArr.length);
			
			history.append(text + "<br/>");
			
			text = text.replace(replacementDict[rand].original, "");
			text = text.slice(0, indexArr[randIndex]) + replacementDict[rand].new + text.slice(indexArr[randIndex]);
			
			$("#sterbin").val(text);
		});
		
	</script>
</body>
</html>