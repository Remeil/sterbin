<!DOCTYPE HTML>
<html>
<head>
	<title>Sterbin</title>
	<script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha256-/SIrNqv8h6QGKDuNoLGA4iret+kyesCkHGzVUUV0shc=" crossorigin="anonymous"></script>
</head>
<body>
	<input type="text" id="sterbin" value="Steven" style="min-width: 400px;"/>
	<button type="button" id="doIt">Sterbinify</button> <br/> <br/>
	<div id="history">
	</div>
	
	<script>
		function Replacement(replace, replacer) {
			this.original = replace;
			this.new = replacer;
		}
		
		var REDUCER_WEIGHT = 3;
	
		var replacementDict = [];
		
		function addToReplacementDict(replace, replacer, weight) {
			for (var i = 0; i < weight; i++) {
				replacementDict.push(new Replacement(replace, replacer));
			}
		}
		
		addToReplacementDict("v", "ph", 1);
		addToReplacementDict("ph", "phph", 1);
		addToReplacementDict("ph", "fe", 1);
		addToReplacementDict("bin", "erbin", 1);
		addToReplacementDict("st", "pht", 1);
		addToReplacementDict("e", "eve", 1);
		addToReplacementDict("b", "beeb", 1);
		addToReplacementDict("b", "bl", 1);
		addToReplacementDict("v", "fph", 1);
		addToReplacementDict("eb", "erb", 1);
		addToReplacementDict("ven", "bin", 1);
		addToReplacementDict("ph", "phb", 1);
		addToReplacementDict("ph", "bph", 1);
		addToReplacementDict("sterbin", "sterbenflerben", 25);
		addToReplacementDict("Sterbin", "Sterbenflerben", 25);
		addToReplacementDict("er", "fler", 1);
		addToReplacementDict("bin", "flerben", 1);
		addToReplacementDict("j", "h", 1);
		
		//Reducers
		addToReplacementDict("ee", "e", 1 * REDUCER_WEIGHT);
		addToReplacementDict("bb", "b", 1 * REDUCER_WEIGHT);
		addToReplacementDict("phph", "ph", 1 * REDUCER_WEIGHT);
		addToReplacementDict("flfl", "fl", 1 * REDUCER_WEIGHT);
		
		function indexes(source, find) {
			var result = [];
			for (i = 0; i < source.length; ++i) {
				if (source.substring(i, i + find.length) == find) {
					result.push(i);
				}
			}
			return result;
		}
	
		$("#doIt").on("click", function() {
			var text = $("#sterbin").val();
			var history = $("#history");
			var myDict = JSON.parse(JSON.stringify(replacementDict));
			
			var index = -1;
			
			while(index < 0) {
				if (myDict.length === 0) {
					alert("couldn't find replacement");
					throw {
						name: "I couldn't do it exception",
						message: "sterbin come back, ooooooooh you can blame it all on me",
						toString: function() {return this.name + ": " + this.message;}
					};
				}
			
				var rand = Math.floor(Math.random() * myDict.length);
				index = text.indexOf(myDict[rand].original);
				
				if (index < 0) {
					myDict.splice(rand, 1);
				}
			}
			
			var indexArr = indexes(text, myDict[rand].original);
			var randIndex = Math.floor(Math.random() * indexArr.length);
			
			history.append(text + "<br/>");
			
			text = text.replace(myDict[rand].original, "");
			text = text.slice(0, indexArr[randIndex]) + myDict[rand].new + text.slice(indexArr[randIndex]);
			
			$("#sterbin").val(text);
		});
		
	</script>
</body>
</html>
